<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PDF Malware Detector</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      .malware { color: red; }
      .not-malware { color: blue; }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Ultimate PDF malware detector using ML(?)/AI</h1>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <label for="file">Choose PDF file</label>
          <input type="file" class="form-control" id="file" name="file">
        </div>
        <div class="form-group">
          <label for="model">Select Model</label>
          <select class="form-control" id="model" name="model">
            {% for model in models %}
              <option value="{{ model }}" {% if model == selected_model %}selected{% endif %}>{{ model }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
      </form>
      <div id="result" class="alert mt-3" style="display: none;"></div>
      <div id="dataframe" class="mt-3"></div>
      <div id="flash" class="alert alert-warning mt-3" style="display: none;"></div>

      <h2 class="mt-5">Decision Rules</h2>
      <table class="table table-bordered mt-3">
        <thead>
          <tr>
            <th>ID</th>
            <th>Condition</th>
            <th>Label</th>
            <th>Trained Samples</th>
          </tr>
        </thead>
        <tbody>
          {% for rule in rules %}
            <tr>
              <td>{{ rule.ID }}</td>
              <td>{{ rule.condition }}</td>
              <td>{{ rule.label }}</td>
              <td>{{ rule.samples }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <script>
      $(document).ready(function () {
        $('#uploadForm').submit(function (event) {
          event.preventDefault();
          
          var formData = new FormData(this);
          
          $.ajax({
            type: 'POST',
            url: '{{ url_for('upload_file') }}',
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
              if (response.flash) {
                $('#flash').text(response.flash).show();
              } else {
                $('#flash').hide();
              }
              
              if (response.result !== undefined) {
                $('#result').removeClass('alert-danger alert-primary malware not-malware');
                if (response.result == '1') {
                  $('#result').addClass('alert-danger malware').text('Malware').show();
                } else {
                  $('#result').addClass('alert-primary not-malware').text('Not Malware').show();
                }
              }
              
              if (response.dataframe_html) {
                $('#dataframe').html(response.dataframe_html);
              } else {
                $('#dataframe').empty();
              }
            },
            error: function () {
              $('#flash').text('An error occurred during the file upload.').show();
            }
          });
        });
      });
    </script>
  </body>
</html>
